%\chapter{Fusão de evidências} \label{cap_fusao}
\section{Métodos de fusão para as evidências de bordas}
As evidências de bordas estão armazenadas em  $n_c$ imagens binárias $\{\widehat{\bm\jmath}_c\}_{1\leq c\leq n_c}$ em que o pixel de valor 1 denota uma estimativa de borda e o pixel de valor 0 denota um elemento onde não foi detectado borda. As imagens (matrizes) têm tamanho  $m\times n$; onde podemos definir $\ell= mn$. Estas imagens serão usadas para a fusão resultando na imagem binária $I_\text{F}$.

Comparamos os resultados de seis técnicas de fusão:
\begin{itemize} 
\item média simples, 
\item transformada wavelet discreta multi-resolução (MR-DWT),
\item transformada wavelet estacionária multi-resolução (MR-SWT), 
\item análise de componentes principais (PCA),
\item estatísticas ROC, e
\item decomposição em valores singulares com multi-resolução (MR-SVD).
\end{itemize}
\subsection{Fusão por média simples}
A fusão por média simples realiza a média aritmética das evidências de bordas para cada cada canal,
$\bm I_\text{F}(x,y)=(n_c)^{-1}\sum_{c=1}^{n_c} \widehat{\bm\jmath}_c(x,y)$, onde $nc$ é o número de canais a serem utilizados na fusão. A figura~\eqref{fig:cap_fusao_media_simples} apresenta o fluxograma para a fusão por média simples, podemos obter mais detalhes na referência \cite{mit}.

\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}
%
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}
\tikzstyle{sensor}=[draw, fill=blue!20, text width=5em, 
    text centered, minimum height=2.5em,drop shadow]
\tikzstyle{ann} = [above, text width=5em, text centered]
\tikzstyle{wa} = [sensor, text width=15em, fill=red!20, 
    minimum height=6em, rounded corners, drop shadow]
\tikzstyle{sc} = [sensor, text width=13em, fill=red!20, 
    minimum height=10em, rounded corners, drop shadow]
\def\blockdist{2.3}
\def\edgedist{2.5}
	\begin{figure}[htb!]
\centering
\begin{tikzpicture}
	\node (wa) [wa]  {$\bm I_\text{F}(x,y)=(n_c)^{-1}\sum_{c=1}^{n_c} \widehat{\bm\jmath}_c(x,y)$};
	\path (wa.west)+(-3.2,1.5) node (e1) [sensor] {$\widehat{\bm\jmath}_1(x,y)$};
    \path (wa.west)+(-3.2,0.5) node (e2)[sensor] {$\widehat{\bm\jmath}_2(x,y)$};
    \path (wa.west)+(-3.2,-1.0) node (dots)[ann] {$\vdots$}; 
    \path (wa.west)+(-3.2,-2.0) node (e3)[sensor] {$\widehat{\bm\jmath}_3(x,y)$};    
%
    \path [draw, ->] (e1.east) -- node [above] {} 
        (wa.160) ;
    \path [draw, ->] (e2.east) -- node [above] {} 
        (wa.180);
    \path [draw, ->] (e3.east) -- node [above] {} 
        (wa.200);   
\end{tikzpicture}
	\caption{Fusão por média simples.}
\label{fig:cap_fusao_media_simples}
\end{figure}
%
\subsection{Fusão usando o método wavelet discreta Multi-Resolução -- MR-DWT} 
Esta seção é baseada em~\cite{n_r}. Vamos aplicar os filtros DWT em cada imagem binaria $\bm{\widehat\jmath}_c$: um filtro de passa baixa \textbf{L}  na direção vertical, e um filtro de passa alta \textbf{H} na direção horizontal, então ambos são \textit{down-sampled} para formar as matrizes de coeficientes~$\bm{\widehat\jmath}_{c\text{L}}$~e~$\bm{\widehat\jmath}_{c\text{H}}$.  

As operações são repetidas nas matrizes de coeficientes~$\bm{\widehat\jmath}_{c\text{L}}$~e~$\bm{\widehat\jmath}_{c\text{H}}$ resultando em $\bm{\widehat\jmath}_{c\text{LL}}$, $\bm{\widehat\jmath}_{c\text{LH}}$, $\bm{\widehat\jmath}_{c\text{HL}}$,~e~$\bm{\widehat\jmath}_{c\text{HH}}$.

A fusão de evidências de bordas tem os seguintes passos para cada nível de resolução:
\begin{enumerate}
\item Calculate a decomposiçao DWT $\bm{\widehat\jmath}_{c\text{LL}}$, $\bm{\widehat\jmath}_{c\text{LH}}$, $\bm{\widehat\jmath}_{c\text{HL}}$, and $\bm{\widehat\jmath}_{c\text{HH}}$, para cada canal.
\item Compute $\bm{\bar\jmath}_{c\text{HH}}$, a média pixel a pixel para todas as $\bm{\widehat\jmath}_{c\text{HH}}$ decomposições.
\item Encontrar o máximo pixel a pixel de $\bm{\widehat\jmath}_{c\text{LL}}$, $\bm{\widehat\jmath}_{c\text{LH}}$, $\bm{\widehat\jmath}_{c\text{HL}}$ resultando em $\bm{\bar\jmath}_{c\text{LL}}$, $\bm{\bar\jmath}_{c\text{LH}}$, e $\bm{\bar\jmath}_{c\text{HL}}$.
\item O resultado da fusão $I_\text{F}$ é a transformação inversa DWT para os coeficientes das matrizes $\bm{\bar\jmath}_{c\text{HH}}$, $\bm{\bar\jmath}_{c\text{LL}}$, $\bm{\bar\jmath}_{c\text{LH}}$, e $\bm{\bar\jmath}_{c\text{HL}}$.
\end{enumerate}

O fluxograma para o método de fusão MR-DWT pode ser visto na figura \eqref{fig:cap_fusao_dwt}. Na figura W e $\text{W}^{-1}$ representam a transformação para obter a decomposição wavelet e a transformação inversa respectivamente, 
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}
\tikzstyle{sensor}=[draw, fill=blue!20, text width=5.5em, 
    text centered, minimum height=2.5em,drop shadow]
\tikzstyle{ann} = [above, text width=5em, text centered]
\tikzstyle{wa} = [sensor, text width=7em, fill=red!20, 
    minimum height=3em, rounded corners, drop shadow]
\tikzstyle{sc} = [sensor, text width=10em, fill=red!20, 
    minimum height=7em, rounded corners, drop shadow]
\def\blockdist{2.3}
\def\edgedist{2.5}
	\begin{figure}[htb!]
\begin{tikzpicture}
	\path (wa.west)+(-3.0,1.5) node (swtnode1) [sensor] {$\text{Coef DWT}_1$};
	\path (wa.west)+(-3.0,0.5) node (swtnode2) [sensor] {$\text{Coef DWT}_2$};
	\path (wa.west)+(-3.0,-1.0) node (dots)[ann] {$\vdots$}; 
    \path (wa.west)+(-3.0,-2.0) node (swtnode3)[sensor] {$\text{Coef DWT}_N$};  
%
	\path (wa.west)+(-6.2,1.5) node (e1) [sensor] {$\widehat{\bm\jmath}_1(x,y)$};
    \path (wa.west)+(-6.2,0.5) node (e2)[sensor] {$\widehat{\bm\jmath}_2(x,y)$};
    \path (wa.west)+(-6.2,-1.0) node (dots)[ann] {$\vdots$}; 
    \path (wa.west)+(-6.2,-2.0) node (e3)[sensor] {$\widehat{\bm\jmath}_N(x,y)$};    
    \path (wa.west)+(1.5,1.0) node (swtnodefus) [wa] {Fusão dos coeficientes\\
                                                       wavelets};                                                      
    \path (wa.west)+(6.0,1.0) node (imagefus) [wa] {Imagem fusão};
    \path [draw, ->] (e1.east) -- node [above] {W} 
        (swtnode1.180) ;
    \path [draw, ->] (e2.east) -- node [above] {W} 
        (swtnode2.180);
    \path [draw, ->] (e3.east) -- node [above] {W} 
        (swtnode3.180);
%
    \path [draw, ->] (swtnode1.east) -- node [above] {} 
        (swtnodefus.160) ;
    \path [draw, ->] (swtnode2.east) -- node [above] {} 
        (swtnodefus.180);
    \path [draw, ->] (swtnode3.east) -- node [above] {} 
        (swtnodefus.200);      
    \path [draw, ->] (swtnodefus.east) -- node [above] {$W^{-1}$}      
        (imagefus.west);        
\end{tikzpicture}
	\caption{Fusão MR-DWT.}
\label{fig:cap_fusao_dwt}
\end{figure}
%
\subsection{Fusão usando o método wavelet discreta Multi-Resolução -- MR-SWT} 
Esta sectão é baseada em~\cite{n_r, jjly}. A diferenção entre os métodos MR-DWT e MR-SWT é a substituição do operador transformada discrete wavelet (DWT) por operador transformada estacionária wavelet (SWT).

O fluxograma para o método de fusão MR-SWT pode ser visto na figura \eqref{fig:cap_fusao_swt}. Na figura W e $\text{W}^{-1}$ representam a transformação para obter a decomposição wavelet e a transformação inversa respectivamente
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}
\tikzstyle{sensor}=[draw, fill=blue!20, text width=5.5em, 
    text centered, minimum height=2.5em,drop shadow]
\tikzstyle{ann} = [above, text width=5em, text centered]
\tikzstyle{wa} = [sensor, text width=7em, fill=red!20, 
    minimum height=3em, rounded corners, drop shadow]
\tikzstyle{sc} = [sensor, text width=10em, fill=red!20, 
    minimum height=7em, rounded corners, drop shadow]
\def\blockdist{2.3}
\def\edgedist{2.5}
	\begin{figure}[htb!]
\begin{tikzpicture}
	\path (wa.west)+(-3.0,1.5) node (swtnode1) [sensor] {$\text{Coef SWT}_1$};
	\path (wa.west)+(-3.0,0.5) node (swtnode2) [sensor] {$\text{Coef SWT}_2$};
	\path (wa.west)+(-3.0,-1.0) node (dots)[ann] {$\vdots$}; 
    \path (wa.west)+(-3.0,-2.0) node (swtnode3)[sensor] {$\text{Coef SWT}_N$};  
	
	\path (wa.west)+(-6.2,1.5) node (e1) [sensor] {$\widehat{\bm\jmath}_1(x,y)$};
    \path (wa.west)+(-6.2,0.5) node (e2)[sensor] {$\widehat{\bm\jmath}_2(x,y)$};
    \path (wa.west)+(-6.2,-1.0) node (dots)[ann] {$\vdots$}; 
    \path (wa.west)+(-6.2,-2.0) node (e3)[sensor] {$\widehat{\bm\jmath}_N(x,y)$};    
    \path (wa.west)+(1.5,1.0) node (swtnodefus) [wa] {Fusão dos coeficientes\\
                                                       wavelets};                                                      
    \path (wa.west)+(6.0,1.0) node (imagefus) [wa] {Imagem fusão};
    \path [draw, ->] (e1.east) -- node [above] {W} 
        (swtnode1.180) ;
    \path [draw, ->] (e2.east) -- node [above] {W} 
        (swtnode2.180);
    \path [draw, ->] (e3.east) -- node [above] {W} 
        (swtnode3.180);
%
    \path [draw, ->] (swtnode1.east) -- node [above] {} 
        (swtnodefus.160) ;
    \path [draw, ->] (swtnode2.east) -- node [above] {} 
        (swtnodefus.180);
    \path [draw, ->] (swtnode3.east) -- node [above] {} 
        (swtnodefus.200);      
    \path [draw, ->] (swtnodefus.east) -- node [above] {$W^{-1}$}      
        (imagefus.west);        
\end{tikzpicture}
	\caption{Fusão MR-SWT.}
\label{fig:cap_fusao_swt}
\end{figure}
%
\subsection{Fusão usando o método análise das componentes principais -- PCA} 
Esta seção é baseada em~\cite{n_r,mit}. O método pode ser resumido nos seguinte passos:
\begin{enumerate}
\item Armazene as imagens binárias $\bm{\widehat\jmath}_c$ em colunas para obter am matriz $\bm X_{\ell\times n_c}$.
\item Calcule a matriz de covariância $\bm C_{n_c\times n_c}$ de $\bm X_{\ell\times n_c}$.
\item Calcule as matrizes de autovalores ($\bm\Lambda$) e autovetores ($\bm V$) da matriz de covariância, ordene os autovalores e seus respectivos autovalores de maneira decrescente.
\item Encontre o vetor $\bm P=(P(1),\dots,P(n_c))=(\sum_{c=1}^{n_c} V(c))^{-1}{\bm V}$, onde $\bm V_c$ é o autovetor associado com o maior autovalor de $\bm X$; note que $\sum_{c=1}^{n_c}\bm P_c=1$.
\item Realize a fusão $\bm I_F(x,y)=\sum_{c=1}^{n_c} P(c)\bm{\widehat\jmath}_c(x,y)$.
\end{enumerate}

O fluxograma para a fusão usando o método PCA pode ser visto na figura \eqref{fig:cap_fusao_pca}.
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}
\tikzstyle{sensor}=[draw, fill=blue!20, text width=5em, 
    text centered, minimum height=2.5em,drop shadow]
\tikzstyle{ann} = [above, text width=5em, text centered]
\tikzstyle{wa} = [sensor, text width=7em, fill=red!20, 
    minimum height=3em, rounded corners, drop shadow]
\tikzstyle{sc} = [sensor, text width=15em, fill=red!20, 
    minimum height=7em, rounded corners, drop shadow]
\def\blockdist{2.3}
\def\edgedist{2.5}
	\begin{figure}[htb!]
\begin{tikzpicture}
	\path (wa.west)+(-2.0,0.0) node (pcanode) [wa] {$\text{PCA}$};
	\path (wa.west)+(-6.2,1.5) node (e1) [sensor] {$\widehat{\bm\jmath}_1(x,y)$};
    \path (wa.west)+(-6.2,0.5) node (e2)[sensor] {$\widehat{\bm\jmath}_2(x,y)$};
    \path (wa.west)+(-6.2,-1.0) node (dots)[ann] {$\vdots$}; 
    \path (wa.west)+(-6.2,-2.0) node (e3)[sensor] {$\widehat{\bm\jmath}_N(x,y)$};    
    \path (wa.west)+(4.0,0.0) node (pcanodefus) [sc] {$\bm I_\text{F}(x,y)=\sum_{c=1}^{n_c} P(c)\bm{\widehat\jmath}_c(x,y)$};
    \path [draw, ->] (e1.east) -- node [above] {} 
        (pcanode.160) ;
    \path [draw, ->] (e2.east) -- node [above] {} 
        (pcanode.180);
    \path [draw, ->] (e3.east) -- node [above] {} 
        (pcanode.200);
        %
    \path [draw, ->] (pcanode.east) -- node [above] {} 
        (pcanodefus.180) ;  
\end{tikzpicture}
	\caption{Fusão PCA.}
\label{fig:cap_fusao_pca}
\end{figure}

\subsection{Fusão usando a estatística ROC}
O método ROC foi descrito em~\cite{gs,fawcett}, de maneira geral podemos afirmar que o método baseado em estatística ROC funciona da seguinte maneira:
\begin{enumerate}
\item  Adicione as imagens binárias $\bm{\widehat\jmath}_c$ para produzir a matriz de frequência ($\bm V$). 
\item Aplique os limiares $t=1,\dots,n_c$ em $\bm V$ para gerar as matrizes $\bm{\text{M}_t}$.
\item Compare cada $\bm{\widehat\imath}_t$ com todos $\bm{\widehat\jmath}_c$, ache a matriz de confusão para gerar a curva ROC. O limiar ótimo corresponde ao ponto da curva ROC mais perto (no sentido da distancia euclidiana) da linha de diagnóstico.
\item A fusão $\bm{I_\text{F}}$ é a matriz $\bm{\widehat\imath}_t$ que corresponde ao limiar ótimo.
\end{enumerate}

Com o objetivo de descrever o método desenvolvemos os aspectos teóricos da estatísticas ROC.
\subsubsection{A estatística ROC}
As teorias dos artigos \citet{gs} e \citet{fawcett} serão descritas baseadas nas propriedades estatísticas da curva \textit{Receiver Operating Characteristics} (ROC) aplicadas em imagens PolSAR.

As curvas ROC são técnicas para visualizar, organizar e selecionar classificadores aplicados em aprendizado de máquina, visão computacional, inteligência artificial entre outras áreas similares demostrando a capacidade do método para efetuar avaliações e comparações de algoritmos. 

A construção da curva ROC consiste em um problema de classificação com duas classe rotuladas como instâncias do conjunto $\{\mathbf{p},\mathbf{n}\}$, onde $\mathbf{p}$ representa a classe positiva e $\mathbf{n}$ representa a classe negativa. Estabelecendo as instâncias e o classificador podemos definir a matriz de confusão $2\times 2$. 

A tabela (\ref{tab:matrixz_conf}) mostra a matriz de confusão, onde
\begin{enumerate}
    \item Se a instância é positiva e classificada como positiva então é definida como positivo verdadeiro TP.
    \item Se a instância é positiva e classificada como negativa então é definida como negativo falso FN.
	\item Se a instância é negativa e classificada como negativa então é definida como negativo verdadeiro TN
	\item Se a instância é negativa e classificada como positiva então é definida como positivo falso FP
\end{enumerate}

\begin{table}[hbt]
	\centering
	\caption{Matriz de confusão.}\label{tab:matrixz_conf}
\begin{tabular}{@{}cll@{}} \toprule
	                        & \multicolumn{2}{c}{Classes definidas como verdadeiras}           \\ \midrule
	 Classes preditas       & $\mathbf{p}$                & $\mathbf{n}$                \\
                 $\mathbf{p}$& Positivos verdadeiros (TP) & Positivos falsos (FP)      \\ 
	             $\mathbf{n}$& Negativos falsos      (FN) & Negativos verdadeiros (TN) \\ \bottomrule 
\end{tabular}
\end{table}

Os valores da diagonal principal matriz de confusão representam as classificações realizadas corretamente, enquanto os elementos da diagonal secundária representam as classificações incorretas. A soma de todas as possibilidades de resultados em uma classificação retorna o valor TP+FN+FP+TN=1.

Definimos a prevalência como a soma dos positivos verdadeiros com os negativos falsos, P=TP+FN, portanto podemos afirmar que idealmente a prevalência deveria aproximar-se de TP. E definimos \text{Nível}-Q como a soma dos positivos verdadeiros com os positivos falsos, Q=TP+FP, o qual deveria aproximar-se de TP em situações ideais. De acordo com as definições acima, no detector de bordas otimizado a prevalência e o \text{Nível-Q} deverian ser iguais, isto é, P=\text{Nível}-Q. Além disso, se definir N=FP+TN, e recorrer ao fato TP+FN+FP+TN=1, garantimos que P+N=1.  

A matriz de confusão serve de base para a construção da curva ROC, definindo as seguintes métricas,
\begin{equation}\label{eq:tp_rate}
	tp_{\text{rate}}=\frac{\text{TP}}{\text{P}},
\end{equation}
\begin{equation}\label{eq:fp_rate}
	fp_{\text{rate}}=\frac{\text{FP}}{\text{N}}.
\end{equation}

 Na métrica conhecida por razão de positivos verdadeiros, taxa de acerto, \textit{recall} ou  sensibilidade,~$tp_{\text{rate}}=\frac{\text{TP}}{\text{P}}=\frac{\text{TP}}{\text{TP+FN}}$,~se o número de negativos falsos tendem a zero o valor da métrica aproxima-se do valor unitário. Assim como, na métrica conhecida como razão de positivos falsos,~$fp_{\text{rate}}=\frac{\text{FP}}{\text{N}}=\frac{\text{FP}}{\text{FP+TN}}$,~se o número de verdadeiros positivos tendem a zero o valor da métrica aproxima-se do valor unitário.
\subsubsection{Fusão das evidências de bordas usando a estatística ROC}
O método de fusão de evidências baseado na estatística ROC consiste em aplicar a estimativa de máxima verossimilhança em cada canal da imagem PolSAR, gerando imagens binárias com as evidências de bordas $\bm{\widehat\jmath}_c$, sendo $c=1,\dots,n_c$, onde $n_c$ é o número de canais. Após, construímos a matriz de frequência V de mesmo tamanho de $\bm{\widehat\jmath}_c$, tal que em cada pixel é armazenado um valor ao qual corresponde a frequência de ocorrências de evidências de bordas em cada canal $\bm{\widehat\jmath}_c$. Ou seja, a matriz V é a soma pixel a pixel de todas as imagens de  evidências de bordas $\bm{\widehat\jmath}_c$. Podemos afirmar que quanto maior o valor de um pixel, maior sua probabilidade de ser uma borda.

Na matriz de frequência V são aplicados limiares~$\text{CT}_t$, onde $t=1,\dots,n_c$ gerando matrizes chamadas mapas de evidências de bordas $\bm{\widehat\imath}_t$. O objetivo do método é estimar automaticamente o limiar correspondente CT ótimo, proveniente do conjunto de limiares parciais $\text{CT}_t$.

O detector de bordas baseado nas estatística ROC é proposto como um método de fusão de evidências de bordas em diferentes canais da imagem PolSAR, e usado como ferramenta para detectar bordas.

Definições são propostas para desenvolver o algoritmo de detecção de bordas usando a estatística ROC. Então, de maneira similar a tabela \eqref{tab:matrixz_conf} definimos $\{e, ne\}$ respectivamente como bordas e não bordas reais na imagem, e $\{E, NE\}$ respectivamente como bordas preditas e não bordas preditas pelo classificador. A tabela~\ref{tab:matriz_conf_roc} redefini a matriz de confusão usando o método da máxima verossimilhança como classificador.
\begin{table}[hbt]
	\centering
	\caption{Matriz de confusão para as evidências de bordas.}\label{tab:matriz_conf_roc}
\begin{tabular}{@{}lll@{}} \toprule
	     & $e$  & $ne$  \\ \midrule
	$E$  & Positivos verdadeiros (TP) & Positivos falsos     (FP)  \\ 
	$NE$ & Negativos falsos       (FN)& Negativos verdadeiros (TN)\\ \bottomrule  
\end{tabular}
\end{table}

Para construir a curva ROC aplicamos o método da estimativa de máxima verossimilhança em cada canal da imagem PolSAR, ou componentes derivados desse canais, gerando assim imagens binárias com evidências de bordas $\bm{\widehat\jmath}_c$. Como descrito acima, realizando a soma de todas a matrizes $\bm{\widehat\jmath}_c$ resultando na matriz de frequência $\text{V}=\sum_{c=1}^{n_c}\bm{\widehat\jmath}_c$. Na matriz V é aplicado os limiares $\text{CT}_t$ com $t=1,\dots,n_c$ gerando os mapas de evidências de bordas $\bm{\widehat\imath}_t$. O fluxograma do  processo é mostrado na figura \eqref{fig:cap_fusao_roc1}.

\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}
\tikzstyle{sensor}=[draw, fill=blue!20, text width=5em, 
    text centered, minimum height=2.5em,drop shadow]
\tikzstyle{ann} = [above, text width=5em, text centered]
\tikzstyle{wa} = [sensor, text width=10em, fill=red!20, 
    minimum height=6em, rounded corners, drop shadow]
\tikzstyle{sc} = [sensor, text width=13em, fill=red!20, 
    minimum height=10em, rounded corners, drop shadow]
\def\blockdist{2.3}
\def\edgedist{2.5}

\begin{figure}[htb!]
\centering
\begin{tikzpicture}
	\node (wa) [wa]  {$V=\sum_{c=1}^{N}\bm{\widehat\jmath}_c$};
	\path (wa.west)+(-3.2,1.5) node (e1) [sensor] {$\bm{\widehat\jmath}_1$};
    \path (wa.west)+(-3.2,0.5) node (e2)[sensor] {$\bm{\widehat\jmath}_2$};
    \path (wa.west)+(-3.2,-1.0) node (dots)[ann] {$\vdots$}; 
    \path (wa.west)+(-3.2,-2.0) node (e3)[sensor] {$\bm{\widehat\jmath}_N$};    
%   
    \path (wa.east)+(3.2,1.5) node (m1) [sensor] {$\bm{\widehat\imath}_1$};
    \path (wa.east)+(3.2,0.5) node (m2) [sensor] {$\bm{\widehat\imath}_2$};
    \path (wa.east)+(3.2,-1.0) node (dots)[ann] {$\vdots$}; 
    \path (wa.east)+(3.2,-2.0) node (m3) [sensor] {$\bm{\widehat\imath}_N$};
%
    \path [draw, ->] (e1.east) -- node [above] {} 
        (wa.160) ;
    \path [draw, ->] (e2.east) -- node [above] {} 
        (wa.180);
    \path [draw, ->] (e3.east) -- node [above] {} 
        (wa.200);
	\path [draw, ->] (wa.east) -- node [above] {\tiny{$\text{CT}_1$}} 
        (m1.west);
	\path [draw, ->] (wa.east) -- node [above] {\tiny{$\text{CT}_2$}} 
        (m2.west);
	\path [draw, ->] (wa.east) -- node [right] {\tiny{$\text{CT}_N$}} 
        (m3.west);
%               
%    \path (wa.south) +(0,-\blockdist) node (asrs) {Estrutura geral da fusão de evidência proposta};
  
    \begin{pgfonlayer}{background}
        \path (e1.west |- e1.north)+(-0.5,0.3) node (a) {};
        \path (wa.south -| wa.east)+(+0.5,-0.3) node (b) {};
        \path (m3.east |- m3.east)+(+0.5,-0.75) node (c) {};
       %   
        \path[fill=yellow!20,rounded corners, draw=black!50, dashed]
            (a) rectangle (c);           
       %     
    \end{pgfonlayer}
   
\end{tikzpicture}
	\caption{Fluxograma para a aplicação dos limiares na fusão de evidência ROC.}
\label{fig:cap_fusao_roc1}
\end{figure}

Definimos as entradas para cada matriz de confusão $t$,  
\begin{equation}\label{eq:verdadeiro_positivo_j}
	\text{TP}^c_t= \frac{1}{m\cdot n}\sum_{k=1}^{m}\sum_{l=1}^{n} \bm{\widehat\imath}_{E_t}\cap \bm{\widehat\jmath}_{E_c}, \\
\end{equation}
\begin{equation}\label{eq:falso_positivo_j}
	\text{FP}^c_t= \frac{1}{m\cdot n}\sum_{k=1}^{m}\sum_{l=1}^{n} \bm{\widehat\imath}_{E_t}\cap \bm{\widehat\jmath}_{NE_c}, \\
\end{equation}
\begin{equation}\label{eq:verdadeiro_negativo_j}
	\text{TN}^c_t= \frac{1}{m\cdot n}\sum_{k=1}^{m}\sum_{l=1}^{n} \bm{\widehat\imath}_{NE_t}\cap \bm{\widehat\jmath}_{NE_c}, \\
\end{equation}
\begin{equation}\label{eq:falso_negativo_j}
	\text{FN}^c_t= \frac{1}{m\cdot n}\sum_{k=1}^{m}\sum_{l=1}^{n} \bm{\widehat\imath}_{NE_t}\cap \bm{\widehat\jmath}_{E_c}, \\
\end{equation}
e construímos a matriz de confusão para cada $j$ fixado arbitrariamente, desta forma, teremos $n_c$ matrizes de confusão como a mostrada na tabela \eqref{tab:matriz_conf_roc_j},
\begin{table}[htb!]
	\centering
	\caption{Matriz de confusão para cada $\bm{\widehat\imath}_t$}\label{tab:matriz_conf_roc_j}
\begin{tabular}{@{}lll@{}} \toprule
	& $\bm{\widehat\jmath}_{e_c}$  & $\bm{\widehat\jmath}_{ne_c}$  \\ \midrule
	$\bm{\widehat\imath}_{E_t}$    & $TP^c_t$ &  $FP^c_t$  \\ 
	$\bm{\widehat\imath}_{NE_t}$   & $FN^c_t$ &  $TN^c_t$\\ \bottomrule 
\end{tabular}
\end{table}
definimos as médias para $c=1,\dots,n_c$,
\begin{equation}\label{eq:verdadeiro_positivo_media}
	\overline{\text{TP}}_t=\frac{1}{n_c}\sum_{c=1}^{n_c} \text{TP}^c_t
\end{equation}
\begin{equation}\label{eq:falso_positivo_media}
	\overline{\text{FP}_t}=\frac{1}{n_c}\sum_{c=1}^{n_c} \text{TN}^c_t
\end{equation}
\begin{equation}\label{eq:verdadeiro_negativo_media}
	\overline{\text{TN}_t}=\frac{1}{n_c}\sum_{c=1}^{n_c} \text{FP}^c_t
\end{equation}
\begin{equation}\label{eq:falso_negativo_media}
	\overline{\text{FN}_t}=\frac{1}{n_c}\sum_{c=1}^{n_c} \text{FN}^c_t
\end{equation}

A figura \eqref{cap_fusao_fig02} mostra a comparação entre a imagem $\bm{\widehat\imath}_t$ fixada arbitrariamente com todos as imagens~$\bm{\widehat\jmath}_c$ gerando a métrica~$\text{TP}_t$. A notação $\overline{\cap \bm{\widehat\jmath}_c}$~significa que a comparação realizada é a intersecção pixel a pixel entre $\bm{\widehat\imath}_t$ e $\bm{\widehat\jmath}_c$, fazendo a média de acordo com as equações  as~\eqref{eq:verdadeiro_positivo_media},~\eqref{eq:falso_positivo_media}~\eqref{eq:verdadeiro_negativo_media}~e~\eqref{eq:falso_negativo_media}. A notação $+$ refere-se a média de todos os $\text{TP}_t$, ou demais probabilidades $\text{FP}_t$, $\text{FN}_t$ e $\text{TN}_t$.
\tikzstyle{sensor_1}=[draw, fill=blue!20, text width=2.5em, 
    text centered, minimum height=2em,drop shadow]
\tikzstyle{ann_1} = [above, text width=5em, text centered]
\tikzstyle{wa_1} = [sensor, text width=2em, fill=red!20, 
    minimum height=2em, rounded corners, drop shadow]
\tikzstyle{wa1_1} = [sensor, text width=2em, fill=red!20, 
    minimum height=2em, rounded corners, drop shadow]
\begin{figure}[hbt!]
\centering
\begin{tikzpicture}
\node[wa_1] (wa_1) at (0.0,0.0) {$\bm{\widehat\imath}_t$};
\node[wa1_1] (wa1_1) at (4.0,0.0) {$\overline{\text{TP}}_t$};
%
    \path (wa_1.west)+(2.5,1.5) node (e1_1) [sensor_1] {$\text{TP}_1$};
    \path (wa_1.west)+(2.5,0.5) node (e2_1)[sensor_1] {$\text{TP}_2$};
    \path (wa_1.west)+(2.5,-1.0) node (dots)[ann_1] {$\vdots$}; 
    \path (wa_1.west)+(2.5,-2.0) node (e3_1)[sensor_1] {$\text{TP}_N$};    
%
	\path [draw, ->] (wa_1.east) -- node [left] {\tiny{$\overline{\cap \bm{\widehat\jmath}_1}$}} 
        (e1_1.180) ;
	\path [draw, ->] (wa_1.east) -- node [below] {\tiny{$\overline{\cap \bm{\widehat\jmath}_2}$}} 
        (e2_1.180);
	\path [draw, ->] (wa_1.east) -- node [right] {\tiny{$\overline{\cap \bm{\widehat\jmath}_3}$}} 
        (e3_1.180);
	\path [draw, ->] (e1_1.east) -- node [right] {\tiny{$+$}} 
        (wa1_1.160);
	\path [draw, ->] (e2_1.east) -- node [above] {\tiny{$+$}} 
        (wa1_1.180);
	\path [draw, ->] (e3_1.east) -- node [right] {\tiny{$+$}} 
        (wa1_1.200);
  
    \begin{pgfonlayer}{background}
        \path (wa_1.west |- wa_1.north)+(5.25,1.75) node (a) {};
        \path (e1_1.south -| e1_1.north)+(-2.75,-3.75) node (b) {};
        %\path (wa1.east |- wa1.east)+(+4.0,-0.5) node (c) {};
       %   
        \path[fill=yellow!20,rounded corners, draw=black!50, dashed]
            (a) rectangle (b);           
       %     
    \end{pgfonlayer}
    
\end{tikzpicture}
\caption{Estrutura para fusão de evidências com $j$ escolhido arbitrariamente.}
\label{cap_fusao_fig02}
\end{figure}

A curva ROC é encontrada calculando as razões de positivos verdadeiros, e a razão de positivos falsos para cada  mapas de bordas $\bm{\widehat\imath}_t$, definidas respectivamente como:  

\begin{equation}\label{eq:tp_rate_t}
	\text{TP}_{rate_{t}}=\frac{\overline{TP}_t}{\overline{TP}_t+\overline{FN}_t}. \\
\end{equation}
e
\begin{equation}\label{eq:tp_rate_t}
	\text{FP}_{rate_{t}}=\frac{\overline{FP}_t}{\overline{FP}_t+\overline{TN}_t}. \\
\end{equation}
onde $\overline{TP}_t+\overline{FN}_t$ representa o número médio de bordas verdadeiras para cada $\bm{\widehat\imath}_t$. Este número é sempre o mesmo independentemente de $t$ e denotado por P.

O gráfico para acurva ROC é bidimensional no qual os valores das razões de positivos falsos $\text{FP}_{rate_t}$ são medidos no eixo horizontal, e as razões de positivos verdadeiros $\text{TP}_{rate_t}$ são medidos no eixo vertical. Assim, cada mapa de borda $\bm{\widehat\imath}_t$ produz um ponto no gráfico $(\text{FP}_{rate_t}, \text{TP}_{rate_t})$ no plano ROC (eixos cartesianos) gerando a curva ROC. A referência~\cite{fawcett} mostra que o limiar ótimo ocorre na intersecção da curva ROC, ou perto da mesma, com a linha diagnóstico, linha vermelha na figura \eqref{fig:curva_roc}, formada conectando os pontos $(P,P)$ e $(0,1)$ no plano ROC. Escolhemos o limiar ótimo $CT$ correspondendo ao parâmetro $t$ que gera o ponto $(\text{FP}_{rate_t}, \text{TP}_{rate_t})$ mais próximo (métrica euclidiana) da reta diagnóstico determinando a imagem $\bm{\widehat\imath}_t$ com maior acurácia de bordas detectadas. 

A figura \eqref{fig:curva_roc} mostra a fusão baseada na estatística ROC dos canais simulados hh, hv, e vv descritos no capítulo (3). O limiar ótimo aconteceu quando  $t=2$ por ser o ponto com menor distância euclidiana para a linha diagnóstico (linha vermelha) resultando na imagem com melhor acurácia $\bm{\widehat\imath}_2$. 
\begin{figure}[hbt]
\centering
\includegraphics[width=4.0in]{curva_roc_3_canais.pdf}
	\caption{Curva ROC para a imagem simulada de duas folhas.}
\label{fig:curva_roc}
\end{figure}
%
\subsection{Fusão usando o método decomposição em valores singulares multi-resolução -- MR-SVD}
O método fusão MR-SVD, veja~\cite{naidu}, trabalha de maneira similar ao MR-DWT. A diferença consiste em mudar os filtros DWT por filtros SVD. O método pode ser resumido nos seguinte passos: 
\begin{enumerate}
\item Organize as imagens binárias $\bm{\widehat\jmath}_c$ armazenando como blocos $2\times 2$ não sobrepostos, onde cada bloco é colocado como um vetor $4\times 1$ ordenando em colunas para formar a matriz de dados $\bm X_1$ com dimensão ${4\times{\ell}/{4}}$.   
\item Ache a decomposição SVD de  $\bm X_1=\bm U_1 \bm S_1 \bm V_1^T$, onde $\bm U_1$ e $\bm V_1$ são unitárias e têm dimensões ${4\times 4}$ e ${\ell}/{4}\times{\ell}/{4}$ respectivamente. Os valores singulares são ordenados de maneira decrescente, e são colocados na diagonal principal da matriz $\bm S_1$, as demais entradas da matriz são zeros.  
\item Transforme a linhas de $\widehat{\bm X}_1=\bm U_1^T\bm X_1=\bm S_1 \bm V_1^T$ sobre novas matrizes com dimensões ${m}/{2}\times{n}/{2}$: $\{\bm\Phi_1, \bm\Psi_{1\text{V}}, \bm\Psi_{1\text{H}}, \bm\Psi_{1\text{D}}\}$. 
\item Recomece o procedimento em (1) para $\bm\Phi_r$ com $r=2$ até o menor nível de resolução $R$.
\item A MR-SVD decomposição em cada canal é  
\begin{equation}\nonumber
\widehat{\bm X}_c\rightarrow \left\{\bm \Phi_\text{R}^c,\{\bm\Psi_{r\text{V}}^c,\bm\Psi_{r\text{H}}^c,\bm\Psi_{r\text{D}}^c \}_{r=1}^\text{R},\{\bm U_r^c	\}_{r=1}^\text{R} \right\}.
\end{equation}
\item Depois da decomposição ser aplicadas em todos os canais, compute a média dos $\bm\Phi_R^c$ ($\bm\Phi_\text{R}^f$) no menor nível de resolução, e a média $\bm U_r^c$ ($\bm U_\text{r}^f$), para cada $r$, onde $f$ denota a fusão entre os canais.  
\item Ache o máximo pixel a pixel de $\bm\Psi_{r\text{V}}^c$, $\bm\Psi_{r\text{H}}^c$ e $\bm\Psi_{r\text{D}}^c$: $ \bm\Psi_{rV}^f$ $\bm\Psi_{r\text{V}}^f$, $\bm\Psi_{r\text{H}}^f$ e $\bm\Psi_{r\text{D}}^f$.
\item A fusão $\bm I_\text{F}$ é a transformação SVD para cada nível $r=\text{R},\dots,1$, 
\begin{equation}\nonumber
\bm I_\text{F}\leftarrow \left\{\bm \Phi_\text{R}^f,\{\bm\Psi_{r\text{V}}^f,\bm\Psi_{r\text{H}}^f,\bm\Psi_{r\text{D}}^f \}_{r=\text{R}}^1,\{\bm U_r^f\}_{r=\text{R}}^1 \right\}.
\end{equation}
\end{enumerate}